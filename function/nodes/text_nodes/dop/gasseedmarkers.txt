#type: node
#context: dop
#internal: gasseedmarkers
#icon: DOP/gas

= Gas Seed Markers =

"""A microsolver that seeds marker particles around the boundary of a
surface."""

The Gas Seed Markers DOP is a microsolver used in building larger fluid
simulations. The [Fluid Solver|Node:dop/fluidsolver] and [Smoke Solver|Node:dop/smokesolver] DOPs that allow
microsolvers to be added before or after the main solver step to extend
or tweak the simulation. Alternatively, enterprising people may attempt
to build an entire new solver out of microsolvers.

The Gas Seed Markers DOP creates marker particles, or surfels, along
the boundary of a signed distance field. These can be used to correct a
fluid solution to help preserve volume and maintain high detail on
boundaries.

The created surfels have the `Cd` attribute which signifies if they are
inside or outside surfels. Inside surfels are red, outside are green.
They also have a `pscale` attribute which provides their distance to the
surface clamped to between 0.1 and 0.5 of the voxel size.


@parameters
Surfels:
    The geometry data which will be have surfels added to it. Any
    existing surfels will be taken into account in the ensuing
    update. Surfels that are too far outside will be deleted and
    voxels with too few surfels will have additional ones added.
Surfels Group:
    An optional point group to specify which surfels to
    consider when counting existing surfels within a voxel.
Surface:
    The signed distance field to seed the marker surfels around.
    The zero isocontour and an approximately three cell distance on
    other side of it will be seeded with surfels.
Collision Field:
    A signed distance field representing collision geometry. Any
    inside surfel that is inside this field will be deleted.
Source Field:
    A signed distance field representing a fluid source. Any
    outside surfel that is inside this field will be deleted.
Sink Field:
    A signed distance field representing a fluid sink. Any inside
    surfel inside this sink will be deleted.
Surfels Per Voxel:
    The number of surfels per voxel cell. Surfels will be added to
    cells within the bandwidth until this number is reached.
Birth Threshold:
    Surfels will be added to a voxel once the current number drops
    below the product of this parameter and __Surfels Per Voxel__.
Death Threshold:
    Surfels will be deleted from a voxel once the current number rises
    above the product of this parameter and __Surfels Per Voxel__.
Surface Oversampling:
    Oversample surfels by this multiple when within __Oversampling Bandwidth__
    of the surface.
Oversampling Bandwidth:
    Oversample within this number of voxels from the surface or any __Surface__
    volume boundaries, if __Oversample at Boundaries__ is enabled.
Oversample At Boundaries:
    Oversample within __Oversampling Bandwidth__ voxels of the boundaries of
    the __Surface__ volume.
Move To Isosurface:
    Move surfels that are slightly inside or outside the __Surface__ field back
    to the zero isosurface.
Build Inside Surfels:
    Construct marker surfels on the inside of the surface. Inside
    surfels increase volume as they correct the surface by pushing
    out the boundary.
Build Outside Surfels:
    Construct marker surfels on the outside of the surface. Outside
    surfels decrease volume as they correct the surface by pushing
    in the boundary.
Add Particle System:
    Create a particle system in the __Surfels__ geometry if one does
    not exist.
Kill Outside Bounding Box:
    Kill any surfels outside the bounding box of the field specified in
    the __Surface__ parameter.
Copy Nearest Surfel:
    Instead of explicitly setting the `Cd` and `pscale` attributes when
    creating a new surfel, create a copy of the nearest existing surfel,
    including all other attributes.
Interpolation Attributes:
    All attributes matching this pattern will be interpolated to newly
    seeded particles from the surrounding existing particles.  This interpolation
    is more expensive but yields a smoother particle sampling for attributes like
    velocity.
Minimum Radius:
    Surfel's radius will not be smaller than this.  They will
    created this distance from the surface.  This is measured in
    terms of voxel cells.
Maximum Radius:
    Surfel's radius will not be larger than this.  Even if they
    are farther from the surface than this distance, their radius
    will be clamped to this size.  This is measured in terms of
    voxel cells.
Use Bandwidth:
    Use the bandwidth settings to limit the size of the surface boundary
    within which surfels can be created.
Birth Bandwidth:
    Surfels will be created up to this number of cells from the surface if the current number of surfels in the cell is less than surfels per voxel.
Death Bandwidth:
    Surfels will be deleted when they stray this number of cells from the surface boundary.
Slice Number:
    If non-negative, only particles from this slice will be eligible as seeds.  This avoids wastefully seeding particles in external slices that will be eliminated in the next border update.  This only takes effect if the `slice` attribute is present and __Copy Nearest Surfel__ mode is turned on.

    [Include:standard_solver_parms]

@inputs
    [Include:standard_data_inputs]

@outputs
    [Include:standard_data_outputs]

@locals
    [Include:standard_data_locals]

    [Include:standard_locals]



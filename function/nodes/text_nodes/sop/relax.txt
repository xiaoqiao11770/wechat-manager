= Point Relax =

#type: node
#context: sop
#internal: relax
#icon: SOP/relax

#tags: points, relax
#bestbet: relax

"""Moves points with overlapping radii away from each other, optionally on a surface."""

== Overview ==

This node looks for any points that, if they were spheres with the specified
radii, would be overlapping, and attempts to move them to nearby locations
that reduce the overlap.  This helps avoid having points that are too close
to each other.  This process is repeated until there are no overlapping
points, or the __Max Iterations__ limit is reached.

If a second input is attached, the points are confined to that surface when
relaxing, i.e. they will each be relaxed in the plane perpendicular to the
surface normal, and will be projected back onto the surface after each step
of relaxing.  If no second input is attached, by default, the "N" attribute
on the points will be used as if it were the surface normal for each point,
if present.  To relax points in 3D space, instead of in a 2D plane,
turn on __Relax in 3D Space__.

Points are relaxed similarly in the [Scatter|Node:sop/scatter] node.  Point
Relax allows for more control over the point radii, and allows for points
generated by different approaches to be relaxed.  The relaxation algorithm
is a generalization of Lloyd's algorithm, (Voronoi iteration),
with support added for finite and non-equal point radii, as well as
unbounded 2D or 3D space.

NOTE:
    This is intended for use with disconnected points, not for points in meshes.
    It will usually not produce desired results when relaxing points in meshes,
    because it will ignore the mesh.

@parameters

Points to Relax:
    #id: group

    The points that will be moved away from the __Influencing Points__ if any
    have radii overlapping the radii of the __Influencing Points__.
    If these points being relaxed should be moved away from each other, they
    should also be in the __Influencing Points__ group.

Influencing Points:
    #id: influencegroup

    The points that will affect any __Points to Relax__ that have radii
    overlapping the radii of these points.

Surface Primitives:
    #id: surfacegroup

    The primitives from the second input that form the surface that
    the __Points to Relax__ should be relaxed on.

    If the points are initially on a particular set of primitives,
    they may occasionally "hop" to nearby primitives, even ones that may
    not be part of the same surface, so specifying this group can help
    reduce that type of problem.

Max Iterations:
    #id: maxiterations

    This is the maximum number of times that the __Points to Relax__
    will be moved away from the __Influencing Points__.

Point Radius Scale:
    #id: radius

    When __Point Radius Attribute__ is enabled, this scales those radii;
    otherwise, this is used as the radii of the points.  Any
    __Points to Relax__ whose radii are within the radii of
    __Influencing Points__ will be moved away, if possible.

Point Radius Attribute:
    #id: radiusattrib

    When enabled, this point attribute, multiplied by __Point Radius Scale__
    will be used for the radii of the points.  Any
    __Points to Relax__ whose radii are within the radii of
    __Influencing Points__ will be moved away, if possible.

Relax in 3D Space:
    #id: relaxin3d

    When enabled, points will be relaxed in 3D space, instead of relaxing
    points in 2D planes and optionally projecting onto a surface in the
    second input.  This can be significantly slower than relaxing in 2D,
    if there are a large number of __Points to Relax__ whose radii are
    within the radii of __Influencing Points__.

Use Normal Attribute:
    #id: usenormals

    When enabled, points will be relaxed in the 2D plane perpendicular to
    the vectors in the "N" attribute.  If the second input is connected,
    the "N" attribute from the surface will be used, or computed if not
    present; otherwise, the "N" attribute from the __Points to Relax__
    will be used, or computed if not present.  When disabled,
    __Normal Direction__ will be used instead of the attribute.

Normal Direction:

    When __Use Normal Attribute__ is disabled, __Points to Relax__ will
    be relaxed in the 2D plane perpendicular to this vector.

Max Step Size Attribute:
    #id: maxstepattrib

    By default, the maximum distance that a point will be moved in a single
    iteration is approximately its radius, which keeps the relaxation
    stable when there are only small variations in radii.  However, this
    can cause problems when there are large variations in radii, e.g. when
    some radii are zero and others overlap with them, because the
    points may never "escape".  This attribute specifies a separate
    maximum distance that each point can move in a single iteration.

Prim Num Attribute:
    #id: primnumattrib

    When enabled, an attribute will be output indicating the number of the
    surface primitive on which each point stopped.
    Enable this and __Prim UVW Attribute__ for use with
    [Attribute Interpolate|Node:sop/attribinterpolate].

Prim UVW Attribute:
    #id: primuvwattrib

    When enabled, an attribute will be output indicating the coordinates of
    each point in the parameter space of the primitive on which it stopped.
    Enable this and __Prim Num Attribute__ for use with
    [Attribute Interpolate|Node:sop/attribinterpolate].

@related

- [Node:sop/attribinterpolate]
- [Node:sop/scatter]
- [Node:sop/copy]

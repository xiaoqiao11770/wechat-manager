= Mantra: Fur Procedural =

#type: node
#context: shop
#internal: vm_geo_fur
#icon: SHOP/vm_geo_fur

"""Creates a set of hair-like curves across a surface at render time."""

The Mantra Fur Procedural creates a set of curves to represent hairs growing
out from surface polygons or a point cloud.  CVEX shaders can be applied to
manipulate attributes and the shape of the generated curves.

When surface polygons are provided, the number of generated curves is a result
of the density multiplied by the area of the skin polygons.  The area of the
skin polygons is taken from the optional `area` attribute or calculated from
the vertex positions described by the optional `rest` attribute or point
positions.

The optional second input provides guide curves.  The shape of the guide
curves are interpolated to determine the shape of the generated curves
(before CVEX shaders are applied) ignoring the __Length__ and __Vertices__,
on the Mantra Fur Procedural.  Specify a Float3 primitive attribute called
`guideorigin` on the guide curve geometry to use location-based interpolation.
When the `guideorigin` attribute is present, __Guide Radius__ will indicate
the size of the area influenced by each guide curve.

The optional third input provides clump curves.  The `clumporigin` and
`clumpradius` attributes on the clump curves are used to map each generated
curve to a clump.

The optional fourth input provides curves for parting lines.

@attributes

The Mantra Fur Procedural uses the following attributes from the input
geometries.

table>>
    tr>>
        th>> Name
        th>> Source
        th>> Class
        th>> Type
        th>> Description
    tr>>
        td>> area
        td>> Skin
        td>> Primitive
        td>> Float
        td>> This attribute describes the area of each polygon in the skin geometry.  This affects the number of curves generated by the primitive.  This attribute is optional, if missing the area of each primitive will be computed.
    tr>>
        td>> clumporigin
        td>> Clumps
        td>> Primitive
        td>> Float3
        td>> Describes where each clump originates on the rest skin.
    tr>>
        td>> clumpradius
        td>> Clumps
        td>> Primitive
        td>> Float
        td>> Maximum distance from the clump origin hairs may originate and still be a member of the clump.
    tr>>
        td>> furdensity
        td>> Skin
        td>> Any
        td>> Float
        td>> This attribute is used as a scalar multiplier to the __Density__ parameter and affects the number of generated curves.  If this value is reduced by a CVEX skin shader, some curves will be removed to reflect the lowered density value.  This attribute is optional, if missing a value of 1 is used.
    tr>>
        td>> guideorigin
        td>> Guides
        td>> Primitive
        td>> Float3
        td>> Describes where each guide originates on the rest skin.
    tr>>
        td>> guideradius
        td>> Guides
        td>> Primitive
        td>> Float
        td>> Maximum distance from the guide origin hairs may originate and still be affected by the guide.
    tr>>
        td>> N
        td>> Skin
        td>> Point
        td>> Float3
        td>> If guide hairs are not used, this attribute describes the direction of generated curves.
    tr>>
        td>> rest
        td>> Skin
        td>> Point or Vertex
        td>> Float3
        td>> This attribute describes the rest position of each point in the skin geometry.  This affects the calculation of each polygon's area when determining the number of generated curves.  This value is also used to map each generated curve to a clump.  This attribute is optional, if missing the point's position is used.

The Mantra Fur Procedural makes the following special attributes available
to the CVEX shaders.

table>>
    tr>>
        th>> Name
        th>> Class
        th>> Type
        th>> Description
    tr>>
        td>> clumpP
        td>> Vertex
        td>> Float3
        td>> Describes the position of each vertex in the associated clump hair.  This attribute is only available in the Guide Shader.
    tr>>
        td>> clumproot
        td>> Primitive
        td>> Float3
        td>> Describes the position on the skin from which each clump hair is grown.
    tr>>
        td>> hairid
        td>> Primitive
        td>> Integer
        td>> Contains a unique ID for each generated curve.  This is a read-only attribute.
    tr>>
        td>> hairroot
        td>> Primitive
        td>> Float3
        td>> Describes the position on the skin from which each hair is grown.
    tr>>
        td>> hairdist
        td>> Vertex
        td>> Float
        td>> Describes each vertex's parameterized distance along the curve in the `[0, 1]` range.  This attribute is only available in the Guide Shader.
    tr>>
        td>> P
        td>> Point
        td>> (point position)
        td>> Describes the position of each vertex in the generated hairs.  This attribute is only available in the Guide Shader.
    tr>>
        td>> restxdir
        td>> Primitive
        td>> Float3
        td>> Describes the x-axis direction of the `rest` attribute as a world space direction.  The Fur SOP only provides this value if surface polygons are used to describe the skin.
    tr>>
        td>> restydir
        td>> Primitive
        td>> Float3
        td>> Describes the y-axis direction of the `rest` attribute as a world space direction.  The Fur SOP only provides this value if surface polygons are used to describe the skin.
    tr>>
        td>> restzdir
        td>> Primitive
        td>> Float3
        td>> Describes the z-axis direction of the `rest` attribute as a world space direction.  The Fur SOP only provides this value if surface polygons are used to describe the skin.

The Mantra Fur Procedural can be used to interpolate (and manipulate using
CVEX shaders) any attribute.  The following are some related attributes
used by mantra.

table>>
    tr>>
        th>> Name
        th>> Type
        th>> Description
    tr>>
        td>> orient
        td>> Float3
        td>> Hint direction for orienting the ribbons used to represent curves.
    tr>>
        td>> width
        td>> Float
        td>> Width of the rendered curves.

@parameters

== Main ==

    Skin:
	Path to an object containing skin geometry.
    Guides:
	Path to an object containing guide hairs.
    Clumps:
	Path to an object containing clump center geometry.
    Expand Bounds:
	Allows you to adjust the bounds of the bounding box to compensate for
	any fur that may have been moved outside of the original bounds by a
	shader.

    == Fur ==

    Group:
	Primitives in the skin geometry from which to grow hair.
    Primitive Type:
	Type of geometry to create.

	Polygon:
	    Create a polyline.
	NURBS:
	    Create a NURBS curve.
    Segments:
	Number of segments in each generated curve (ignored if geometry is
	provided by the "Guides" input).
    Length:
	Specifies the length of the generated curves.
    Seed:
	Seed value for the random number generator.
    Density:
	The number of generated curves is a result of the density
	multiplied by the area of the skin polygons.  The value of this
	parameter acts as a scalar multiplier to the optional `furdensity`
	attribute to determine the curve density.
    Display Ratio:
	Specifies a fraction of the curves to display.
    Guide Radius:
	Maximum distance a hair can be from a guide hair and still be
	influenced by the guide hair.
    Clump Radius:
	Maximum distance a hair can be from a clump and still be a member of
	the clump.
    Use Closest Clump:
	Associates each hair with its closest clump.
    Remove Unclumped Hairs:
	Removes all hairs not associated with a clump.
    Remove Unguided Hairs:
	Removes all hairs not influenced by a guide hair.
    Parting Radius:
	Maximum distance a hair can be from a parting line and still be
	affected by the parting line.

    == Attributes ==

	== Skin ==

	Skin Shader:
	    The __Skin Shader__ parameter specifies a CVEX SHOP to manipulate
	    attributes interpolated from the skin geometry.  Each attribute
	    has a single value for each generated curve.  A unique value for
	    each curve is available for reading in the `hairid` value.  In
	    the case of the `furdensity` variable, reducing the value will
	    result in hairs being removed but increasing the value has no
	    effect.
	New Class:
	    Class for transferred attributes.
	Transfer Attributes:
	    Specifies a list of attributes from the skin geometry that will be
	    transferred to the generated curves.  The resulting attribute
	    values will contain any modifications made by CVEX shaders.
	Set Hair ID:
	    Creates a `hairid` attribute containing a unique value for each
	    generated curve.

	== Guide ==

	Guide Shader:
	    The __Guide Shader__ parameter specifies a CVEX SHOP to manipulate
	    attributes interpolated from the guide and clump geometries.  Each
	    attribute has a separate value for each vertex in the generated
	    curves.  The special `P` variable may be used to manipulate the
	    vertex position.
	New Class:
	    Class for transferred attributes.
	Transfer Attributes:
	    Specifies a list of attributes from the guide and clump curves that
	    will be transferred to the generated curves.  The resulting
	    attribute values will contain any modifications made by CVEX
	    shaders.

== IFD Bounds ==

Bounding Box:    
    The bounding box controls let you specify a bounding box for the referenced geometry. Only when this bounding box is "on screen" will mantra load the referenced geometry. You can set __Bounding Box__ to __No bounding box required__, in which case mantra will always load the references geometry regardless. You can also specify the bounding box by referencing the SOP's bounding box in the __SOP Bounds__ parameter.

SOP Bounds:
    The geometry whose bounding box you want to reference.

Min Bounds:
    The minimum bounding box dimensions, when setting explicit bounds.

Max Bounds:
    The maximum bounding box dimensions, when setting explicit bounds.
